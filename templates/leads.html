{% extends "base.html" %}

{% block title %}Leads - AI Sales Agent{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
        <div>
            <h1 style="font-size: 2rem; font-weight: 800; color: #1e293b; margin-bottom: 0.25rem;">Your Leads</h1>
            <p style="color: #64748b;">Security + Solar prospects <span style="color: #16a34a; font-weight: 600;">(FREE - no API costs!)</span></p>
        </div>
        <div style="display:flex; gap: 0.5rem; flex-wrap: wrap;">
            <a href="{{ url_for('client_portal') }}" class="btn btn-secondary">Client Portal</a>
            {% if can_access %}
                <a href="{{ url_for('export_leads') }}" class="btn btn-primary">Export CSV</a>
            {% else %}
                <a href="{{ url_for('subscription') }}" class="btn btn-secondary">Upgrade to Export</a>
            {% endif %}
        </div>
    </div>

    <!-- Quick Stats -->
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
        <div class="glass-card" style="padding: 1rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: 800; color: #3b82f6;">{{ leads|length if leads else 0 }}</div>
            <div style="color: #64748b; font-size: 0.85rem;">Total Leads</div>
        </div>
        <div class="glass-card" style="padding: 1rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: 800; color: #10b981;">{{ leads|selectattr('email')|list|length if leads else 0 }}</div>
            <div style="color: #64748b; font-size: 0.85rem;">With Email</div>
        </div>
        <div class="glass-card" style="padding: 1rem; text-align: center;">
            <div style="font-size: 2rem; font-weight: 800; color: #f59e0b;">{{ leads|selectattr('website')|list|length if leads else 0 }}</div>
            <div style="color: #64748b; font-size: 0.85rem;">With Website</div>
        </div>
    </div>

    <div class="glass-card">
        {% if not can_access %}
            <div style="background: #fff7ed; border: 1px solid #fed7aa; padding: 0.75rem 1rem; border-radius: 12px; color: #9a3412; margin-bottom: 1rem;">
                üîí Upgrade to view full contact details and export leads.
            </div>
        {% endif %}
        
        <!-- Buy More Leads Prompt -->
        <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(59, 130, 246, 0.1)); border: 1px solid rgba(16, 185, 129, 0.3); padding: 1rem 1.25rem; border-radius: 12px; margin-bottom: 1rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <span style="font-size: 1.5rem;">üéØ</span>
                <div>
                    <div style="font-weight: 700; color: #1e293b;">Need more leads?</div>
                    <div style="font-size: 0.85rem; color: #64748b;">Get 50 verified leads instantly for just R99.99</div>
                </div>
            </div>
            <a href="{{ url_for('subscription') }}" class="btn btn-primary" style="white-space: nowrap;">
                Buy 50 Leads - R99.99
            </a>
        </div>

        <!-- LEADS TABLE - SHOW FIRST -->
        {% if leads %}
            <div style="overflow-x: auto;">
                <table class="custom-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Website</th>
                            <th>Niche</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lead in leads %}
                        <tr>
                            <td style="font-weight: 600;">{{ lead.name }}</td>
                            <td>
                                {% if lead.email %}
                                    {% if can_access or lead.is_unlocked %}
                                        <a href="mailto:{{ lead.email }}" style="color: #3b82f6;">{{ lead.email }}</a>
                                    {% else %}
                                        {{ mask_email(lead.email) }}
                                    {% endif %}
                                {% else %}
                                    <span style="color: #94a3b8;">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if lead.website %}
                                    <a href="{{ lead.website }}" target="_blank" style="color: #3b82f6; word-break: break-all;">{{ lead.website[:40] }}{% if lead.website|length > 40 %}...{% endif %}</a>
                                {% else %}
                                    <span style="color: #94a3b8;">-</span>
                                {% endif %}
                            </td>
                            <td><span style="background: #f1f5f9; padding: 4px 8px; border-radius: 6px; font-size: 0.8rem;">{{ lead.niche }}</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align:center; padding: 3rem 2rem; background: #f8fafc; border-radius: 12px; margin-bottom: 1.5rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                <h3 style="color: #1e293b; margin-bottom: 0.5rem;">No leads yet</h3>
                <p style="color: #64748b; margin-bottom: 1.5rem;">Run a lead search from the Dashboard to find prospects</p>
                <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Go to Dashboard ‚Üí</a>
            </div>
        {% endif %}

        <!-- Add Lead Forms - Collapsed at bottom -->
        <details style="margin-top: 1.5rem;">
            <summary style="cursor: pointer; font-weight: 700; color: #1e293b; padding: 0.75rem; background: #f8fafc; border-radius: 8px;">
                ‚ûï Add Leads Manually or Import CSV
            </summary>
            <div style="display:grid; gap: 1rem; margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 12px;">
                <div>
                    <div style="font-weight:600; margin-bottom:0.5rem;">Add Single Lead</div>
                    <form method="POST" action="{{ url_for('add_lead') }}" style="display:grid; grid-template-columns: 1fr 1fr; gap:0.5rem;">
                        <input name="name" placeholder="Name" required style="padding:0.6rem; border:1px solid #e2e8f0; border-radius:8px;">
                        <input name="email" placeholder="Email" style="padding:0.6rem; border:1px solid #e2e8f0; border-radius:8px;">
                        <input name="website" placeholder="Website" style="padding:0.6rem; border:1px solid #e2e8f0; border-radius:8px;">
                        <select name="niche" style="padding:0.6rem; border:1px solid #e2e8f0; border-radius:8px;">
                            <option>Security Services</option>
                            <option>Solar & Renewable Energy</option>
                        </select>
                        <button class="btn btn-secondary" type="submit" style="grid-column: span 2;">Add Lead</button>
                    </form>
                </div>
                <div style="border-top: 1px solid #e2e8f0; padding-top: 1rem;">
                    <div style="font-weight:600; margin-bottom:0.5rem;">üì§ Import CSV</div>
                    <form method="POST" action="{{ url_for('import_leads') }}" enctype="multipart/form-data" style="display:flex; gap:0.5rem; align-items: center; flex-wrap: wrap;">
                        <input type="file" name="file" accept=".csv" required>
                        <button class="btn btn-secondary" type="submit">Import</button>
                        <span style="font-size:0.75rem; color:#64748b;">Headers: name,email,website,niche</span>
                    </form>
                </div>
            </div>
        </details>
    </div>
</div>
{% endblock %}
